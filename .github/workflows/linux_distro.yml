name: Testing Linux Distro

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  
  run-ci-tests:
    name: Ejecutar CI (rust.yml)
    # Llama al workflow de tests definido en rust.yml
    uses: ./.github/workflows/rust.yml

  testing-linux:
    name: Testing on Linux
    runs-on: ubuntu-latest
    
    needs: run-ci-tests
    
    steps:
      - name: Checkout del CÃ³digo
        uses: actions/checkout@v4

      - name: Instalar Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Crear archivo de prueba
        run: echo "This is a test file for int64grep.\nEsta segunda linea" > testfile.txt

      - name: Compilar int64grep
        run: |
            cargo build --release

      - name: Verificar salida 1
        run: |
            OUTPUT=$(./target/release/int64grep "test" testfile.txt)
            if [[ "$OUTPUT" != *"This is a test file for int64grep."* ]]; then
              echo "Error: La salida no es la esperada."
              exit 1
            fi

      - name: Verificar salida 2
        run: |
            OUTPUT=$(./target/release/int64grep "segunda" testfile.txt)
            if [[ "$OUTPUT" != *"Esta segunda linea"* ]]; then
              echo "Error: La salida no es la esperada."
              exit 1
            fi